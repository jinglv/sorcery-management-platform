{"remainingRequest":"/Users/lvjing/sorcery-management-platform/front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lvjing/sorcery-management-platform/front/src/components/HttpRunner/httpRunnerRunResultDialog.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lvjing/sorcery-management-platform/front/src/components/HttpRunner/httpRunnerRunResultDialog.vue","mtime":1689731650659},{"path":"/Users/lvjing/sorcery-management-platform/front/node_modules/cache-loader/dist/cjs.js","mtime":1679466716417},{"path":"/Users/lvjing/sorcery-management-platform/front/node_modules/babel-loader/lib/index.js","mtime":1679466716072},{"path":"/Users/lvjing/sorcery-management-platform/front/node_modules/cache-loader/dist/cjs.js","mtime":1679466716417},{"path":"/Users/lvjing/sorcery-management-platform/front/node_modules/vue-loader/lib/index.js","mtime":1679466707590}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGh0dHBSdW5uZXJSdW5SZXN1bHQsIGh0dHBSdW5uZXJSZW5kZXJSZXBvcnRBcGkgfSBmcm9tICdAL2FwaS9odHRwcnVubmVyJwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHt9LAogIHByb3BzOiB7CiAgICB0eXBlOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogbnVsbAogICAgfQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHNob3dUaXRsZTogJ+afpeeci+aJp+ihjOe7k+aenCcsCiAgICAgIGRpYWxvZ1Zpc2libGU6IHRydWUsCiAgICAgIHJlYXVsdERhdGE6IFtdLAogICAgICByZXE6IHsKICAgICAgICBwYWdlOiAxLAogICAgICAgIHNpemU6IDUKICAgICAgfSwKICAgICAgLy8g5YiG6aG16aG15pWwCiAgICAgIHRvdGFsOiA1CiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5pbml0SHR0cFJ1bm5lclJ1blJlc3VsdExpc3QoKQogIH0sCiAgbWV0aG9kczogewogICAgc3RhdHVzVHlwZSh2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09ICdmYWlsJykgewogICAgICAgIHJldHVybiAnZGFuZ2VyJwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAnbm9uJykgewogICAgICAgIHJldHVybiAnaW5mbycKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ2Vycm9yJykgewogICAgICAgIHJldHVybiAnd2FybmluZycKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ3N1Y2Nlc3MnKSB7CiAgICAgICAgcmV0dXJuICdzdWNjZXNzJwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAn5pyq55+l54q25oCBJwogICAgICB9CiAgICB9LAogICAgY2xvc2VEaWFsb2coKSB7CiAgICAgIHRoaXMuJGVtaXQoJ2NhbmNlbCcsIHt9KQogICAgfSwKICAgIGFzeW5jIGluaXRIdHRwUnVubmVyUnVuUmVzdWx0TGlzdCgpIHsKICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IGh0dHBSdW5uZXJSdW5SZXN1bHQodGhpcy5yZXEsIHRoaXMudHlwZSkKICAgICAgaWYgKHJlc3Auc3VjY2VzcyA9PT0gdHJ1ZSkgewogICAgICAgIGlmICh0aGlzLnR5cGUgIT09ICdBUEknKSB7CiAgICAgICAgICBjb25zdCBpZHMgPSBbXQogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXNwLml0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChyZXNwLml0ZW1zW2ldLmlkcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgaWRzLnB1c2gocmVzcC5pdGVtc1tpXSkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY29uc29sZS5pbmZvKCdpZHM6JywgaWRzKQogICAgICAgICAgdGhpcy5yZWF1bHREYXRhID0gaWRzCiAgICAgICAgICB0aGlzLnRvdGFsID0gaWRzLmxlbmd0aAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnJlYXVsdERhdGEgPSByZXNwLml0ZW1zCiAgICAgICAgICB0aGlzLnRvdGFsID0gcmVzcC50b3RhbAogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3AuaXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHJlc3AuaXRlbXNbaV0uY3JlYXRlX3RpbWUgPSB0aGlzLiRtb21lbnQoCiAgICAgICAgICAgIHJlc3AuaXRlbXNbaV0uY3JlYXRlX3RpbWUKICAgICAgICAgICkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJykKICAgICAgICB9CiAgICAgICAgLy8gdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCfmn6Xor6LmiJDlip/vvIEnKQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+afpeivouWksei0pe+8gScpCiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBzaG93UmVwb3J0KHJvdykgewogICAgICBjb25zdCByZXBvcnRDb250ZW50ID0gYXdhaXQgaHR0cFJ1bm5lclJlbmRlclJlcG9ydEFwaShyb3cubmFtZSkKICAgICAgLy8g5L+d5a2Y6L+bbG9jYWxTdG9yYWdlCiAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY2FsbGJhY2tIVE1MJykKICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdjYWxsYmFja0hUTUwnLCByZXBvcnRDb250ZW50KQogICAgICAvLyDor7vlj5bmnKzlnLDkv53lrZjnmoRodG1s5pWw5o2u77yM5L2/55So5paw56qX5Y+j5omT5byACiAgICAgIGNvbnN0IG5ld1dpbiA9IHdpbmRvdy5vcGVuKCdfJywgJ19ibGFuaycpCiAgICAgIG5ld1dpbi5kb2N1bWVudC53cml0ZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY2FsbGJhY2tIVE1MJykpCiAgICAgIC8vIOWFs+mXrei+k+WHuua1gQogICAgICBuZXdXaW4uZG9jdW1lbnQuY2xvc2UoKQogICAgfSwKICAgIC8vIOi3s+i9rOWIsOesrOWHoOmhtQogICAgaGFuZGxlQ3VycmVudENoYW5nZSh2YWwpIHsKICAgICAgY29uc29sZS5sb2coYOW9k+WJjemhtTogJHt2YWx9YCkKICAgICAgdGhpcy5yZXEucGFnZSA9IHZhbAogICAgICB0aGlzLmluaXRIdHRwUnVubmVyUnVuUmVzdWx0TGlzdCgpCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["httpRunnerRunResultDialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6CA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"httpRunnerRunResultDialog.vue","sourceRoot":"src/components/HttpRunner","sourcesContent":["<template>\n  <el-dialog\n    :title=\"showTitle\"\n    :visible.sync=\"dialogVisible\"\n    width=\"1200px\"\n    :before-close=\"closeDialog\"\n  >\n    <div>\n      <el-table :data=\"reaultData\" border style=\"width: 100%\">\n        <el-table-column prop=\"id\" label=\"ID\" width=\"80\" />\n        <el-table-column prop=\"name\" label=\"报告名称\" />\n        <el-table-column prop=\"name\" label=\"执行内容\" />\n        <el-table-column prop=\"type\" label=\"类型\" />\n        <el-table-column prop=\"result\" label=\"结果\">\n          <template slot-scope=\"{ row }\">\n            <el-tag :type=\"statusType(row.result)\" effect=\"dark\">\n              {{ row.result }}\n            </el-tag>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"create_time\" label=\"创建时间\" />\n        <el-table-column fixed=\"right\" label=\"操作\" width=\"150\">\n          <template slot-scope=\"scope\">\n            <el-button\n              type=\"text\"\n              size=\"small\"\n              @click=\"showReport(scope.row)\"\n            >查看报告</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n    <div style=\"width: 100%; text-align: right\">\n      <el-pagination\n        background\n        layout=\"prev, pager, next\"\n        :page-size=\"req.size\"\n        :total=\"total\"\n        @current-change=\"handleCurrentChange\"\n      />\n    </div>\n  </el-dialog>\n</template>\n\n<script>\nimport { httpRunnerRunResult, httpRunnerRenderReportApi } from '@/api/httprunner'\n\nexport default {\n  components: {},\n  props: {\n    type: {\n      type: String,\n      default: null\n    }\n  },\n  data() {\n    return {\n      showTitle: '查看执行结果',\n      dialogVisible: true,\n      reaultData: [],\n      req: {\n        page: 1,\n        size: 5\n      },\n      // 分页页数\n      total: 5\n    }\n  },\n  mounted() {\n    this.initHttpRunnerRunResultList()\n  },\n  methods: {\n    statusType(value) {\n      if (value === 'fail') {\n        return 'danger'\n      } else if (value === 'non') {\n        return 'info'\n      } else if (value === 'error') {\n        return 'warning'\n      } else if (value === 'success') {\n        return 'success'\n      } else {\n        return '未知状态'\n      }\n    },\n    closeDialog() {\n      this.$emit('cancel', {})\n    },\n    async initHttpRunnerRunResultList() {\n      const resp = await httpRunnerRunResult(this.req, this.type)\n      if (resp.success === true) {\n        if (this.type !== 'API') {\n          const ids = []\n          for (let i = 0; i < resp.items.length; i++) {\n            if (resp.items[i].ids.length > 1) {\n              ids.push(resp.items[i])\n            }\n          }\n          console.info('ids:', ids)\n          this.reaultData = ids\n          this.total = ids.length\n        } else {\n          this.reaultData = resp.items\n          this.total = resp.total\n        }\n        for (let i = 0; i < resp.items.length; i++) {\n          resp.items[i].create_time = this.$moment(\n            resp.items[i].create_time\n          ).format('YYYY-MM-DD HH:mm:ss')\n        }\n        // this.$message.success('查询成功！')\n      } else {\n        this.$message.error('查询失败！')\n      }\n    },\n    async showReport(row) {\n      const reportContent = await httpRunnerRenderReportApi(row.name)\n      // 保存进localStorage\n      window.localStorage.removeItem('callbackHTML')\n      window.localStorage.setItem('callbackHTML', reportContent)\n      // 读取本地保存的html数据，使用新窗口打开\n      const newWin = window.open('_', '_blank')\n      newWin.document.write(localStorage.getItem('callbackHTML'))\n      // 关闭输出流\n      newWin.document.close()\n    },\n    // 跳转到第几页\n    handleCurrentChange(val) {\n      console.log(`当前页: ${val}`)\n      this.req.page = val\n      this.initHttpRunnerRunResultList()\n    }\n  }\n}\n</script>\n<style scoped>\n#image {\n  text-align: left;\n}\n</style>\n"]}]}